<?xml version="1.0"?>

<project default="main" basedir=".">
  <property environment="env" />
  
  <target name="base" >
    <available file="${numfile}" property="numfileexists" />
    <fail message="${numfile} does not exist">
      <condition>
        <isfalse value="${numfileexists}" />
      </condition>
    </fail>
    <propertyfile file="${numfile}" comment="Build Number: ${numfile}">
      <entry  key="version" operation="=" default="1.00"/>
      <entry  key="name" operation="=" default=""/>
      <entry  key="date" type="date" pattern="EEE MMM dd HH:mm:ss zzz yyyy" value="now"/>
      <entry  key="author" operation="=" default=""/>
      <entry key="build.count" type="int" pattern="0" operation="+" default="1"/>
    </propertyfile>
    <condition property="bamboo">
      <and>
        <isset property="env.revision"/>
        <isset property="env.build"/>
      </and>
    </condition>
  </target>

  <target name="build-count" depends="base" if="${bamboo}">
    <propertyfile file="${numfile}" comment="Build Number: ${numfile}">
      <entry key="build" operation="=" value="${env.revision}.${env.build}"/>
    </propertyfile>
  </target>

  <target name="build-stamp" depends="base" unless="${bamboo}">
    <property file="${numfile}"/>
    <propertyfile file="${numfile}" comment="Build Number: ${numfile}">
      <entry key="build" operation="=" value="${build.count}"/>
    </propertyfile>
  </target>

  <target name="main" depends="build-count, build-stamp">
  </target>
</project>


